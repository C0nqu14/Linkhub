{% extends 'base.html' %}
{% block content %}
<div class="container py-5 animate-fade-in">
    <div class="row g-4">
        <div class="col-lg-4">
            <div class="glass-card p-4 text-center sticky-top" style="top: 100px;">
                <div class="position-relative d-inline-block mb-3">
                    <div class="avatar-container position-relative overflow-hidden rounded-circle shadow-lg border border-3 border-secondary">
                        <img src="{{ current_user.get_avatar() }}" 
                             id="profile-img-preview"
                             class="rounded-circle" 
                             width="150" height="150" style="object-fit: cover;">
                        
                        <label for="avatar-input" class="avatar-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
                            <i class="bi bi-camera-fill fs-3 text-white"></i>
                        </label>
                    </div>
                </div>

                <form action="/profile/update" method="POST" enctype="multipart/form-data" id="avatar-form">
                    <input type="file" name="avatar" id="avatar-input" class="d-none" accept="image/*" onchange="submitAvatarForm()">
                </form>

                <h3 class="fw-bold mb-1 text-white">{{ current_user.username }}</h3>
                <p class="text-secondary small mb-4">{{ current_user.email }}</p>

                <div class="bg-black bg-opacity-50 p-3 rounded-4 border border-secondary mb-4 shadow-inner">
                    <div class="row">
                        <div class="col-6 border-end border-secondary border-opacity-50">
                            <small class="small-caps text-secondary d-block mb-1">Karma</small>
                            <span class="fs-4 fw-bold text-accent">{{ current_user.karma }}</span>
                        </div>
                        <div class="col-6">
                            <small class="small-caps text-secondary d-block mb-1">Posts</small>
                            <span class="fs-4 fw-bold text-white">{{ posts|length }}</span>
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <a href="/post/new" class="btn btn-primary fw-bold py-2 shadow-glow">
                        <i class="bi bi-plus-lg me-1"></i> NOVA PUBLICAÇÃO
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="d-flex justify-content-between align-items-end mb-4">
                <h4 class="fw-bold m-0 text-white"><i class="bi bi-collection-fill text-accent me-2"></i>Minhas Publicações</h4>
                <span class="text-secondary small opacity-75">Total de {{ posts|length }} itens</span>
            </div>
            
            {% for post in posts %}
            <div class="glass-card p-3 mb-3 hover-effect">
                <div class="row align-items-center g-3">
                    <div class="col-auto">
                        <img src="{{ post.image_url }}" class="rounded shadow-sm border border-secondary" width="110" height="65" style="object-fit: cover;">
                    </div>
                    <div class="col">
                        <h6 class="fw-bold m-0 mb-1 text-white">{{ post.title }}</h6>
                        <div class="d-flex align-items-center gap-3">
                            <span class="badge {% if post.status == 'approved' %}bg-success-subtle text-success{% else %}bg-warning-subtle text-warning{% endif %} px-2 py-1" style="font-size: 0.65rem;">
                                <i class="bi {% if post.status == 'approved' %}bi-check-circle-fill{% else %}bi-clock-history{% endif %} me-1"></i>
                                {{ post.status|upper }}
                            </span>
                            <small class="text-secondary"><i class="bi bi-arrow-up-circle me-1"></i>{{ post.votes }}</small>
                            <small class="text-secondary"><i class="bi bi-chat-dots me-1"></i>{{ post.comments|length }}</small>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="btn-group shadow-sm">
                            <a href="/app/{{ post.id }}" class="btn btn-sm btn-dark border-secondary" title="Visualizar"><i class="bi bi-eye text-accent"></i></a>
                            <a href="/post/edit/{{ post.id }}" class="btn btn-sm btn-dark border-secondary" title="Editar"><i class="bi bi-pencil text-white"></i></a>
                            <a href="/post/delete/{{ post.id }}" 
                               class="btn btn-sm btn-dark border-secondary" 
                               title="Eliminar"
                               onclick="return confirm('Tem a certeza que deseja eliminar esta publicação permanentemente?')">
                                <i class="bi bi-trash3 text-danger"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="text-center py-5 glass-card border-dashed">
                <div class="bg-dark bg-opacity-50 rounded-circle d-inline-flex p-4 mb-3 border border-secondary border-opacity-25">
                    <i class="bi bi-folder2-open fs-1 text-secondary opacity-50"></i>
                </div>
                <h5 class="text-secondary">Ainda não tens publicações.</h5>
                <p class="text-muted small">A maior comunidade de devs espera pelo teu primeiro projeto!</p>
                <a href="/post/new" class="btn btn-outline-primary btn-sm mt-2 px-4 fw-bold">Começar Agora</a>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
    .shadow-inner { box-shadow: inset 0 2px 10px rgba(0,0,0,0.5); }
    .shadow-glow { box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); transition: 0.3s; }
    .shadow-glow:hover { box-shadow: 0 0 25px rgba(0, 242, 255, 0.4); transform: translateY(-2px); }
    
    .small-caps { font-size: 0.6rem; letter-spacing: 1.5px; text-transform: uppercase; font-weight: 800; }
    
    .bg-success-subtle { background: rgba(0, 255, 136, 0.1) !important; color: #00ff88 !important; border: 1px solid rgba(0, 255, 136, 0.2); }
    .bg-warning-subtle { background: rgba(255, 184, 0, 0.1) !important; color: #ffb800 !important; border: 1px solid rgba(255, 184, 0, 0.2); }

    .btn-dark:hover { background: #1a1f26; border-color: var(--accent); }
</style>

<script>
    function submitAvatarForm() {
        const input = document.getElementById('avatar-input');
        if (input.files && input.files[0]) {
        
            document.body.style.cursor = 'wait';
            document.getElementById('avatar-form').submit();
        }
    }
</script>
{% endblock %}